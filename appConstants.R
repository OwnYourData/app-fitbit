# global constants available to the app
# last update:2016-01-17

# constants required for every app
appName <- 'fitbit'
appTitle <- 'Fitbit'
app_id <- 'eu.ownyourdata.fitbit'

# definition of data structure
currRepoSelect <- ''
appRepos <- list(Schritte = 'eu.ownyourdata.fitbit.steps',
                 Verlauf = 'eu.ownyourdata.fitbit.log')
appStruct <- list(
        Schritte = list(
                fields      = c('date', 'value'),
                fieldKey    = 'date',
                fieldTypes  = c('date', 'integer'),
                fieldInits  = c('empty', 'empty'),
                fieldTitles = c('Datum', 'Schritte'),
                fieldWidths = c(100, 100)),
        Verlauf = list(
                fields      = c('date', 'description'),
                fieldKey    = 'date',
                fieldTypes  = c('date', 'string'),
                fieldInits  = c('empty', 'empty'),
                fieldTitles = c('Datum', 'Text'),
                fieldWidths = c(150, 450)))

# Version information
currVersion <- "0.3.0"
verHistory <- data.frame(rbind(
        c(version = "0.3.0",
          text    = "erstes Release")
))

# app specific constants
scriptRepo <- 'eu.ownyourdata.fitbit.script'
# base64 encoded import_script.R
fitbitStepScript <- 'ZGVmYXVsdEhlYWRlcnMgPC0gZnVuY3Rpb24odG9rZW4pIHsNCiAgYygnQWNjZXB0Jz0nKi8qJywgJ0NvbnRlbnQtVHlwZSc9J2FwcGxpY2F0aW9uL2pzb24nLCAnQXV0aG9yaXphdGlvbic9cGFzdGUoJ0JlYXJlcicsIHRva2VuKSkNCn0NCml0ZW1zVXJsIDwtIGZ1bmN0aW9uKHVybCwgcmVwb19uYW1lKSB7DQogIHBhc3RlMCh1cmwsICcvYXBpL3JlcG9zLycsIHJlcG9fbmFtZSwgJy9pdGVtcycpDQp9DQpnZXRUb2tlbiA8LSBmdW5jdGlvbihwaWFfdXJsLCBhcHBfa2V5LCBhcHBfc2VjcmV0KSB7DQogIGF1dGhfdXJsIDwtIHBhc3RlMChwaWFfdXJsLCAnL29hdXRoL3Rva2VuJykNCiAgb3B0VGltZW91dCA8LSBSQ3VybDo6Y3VybE9wdGlvbnMoY29ubmVjdHRpbWVvdXQgPSAxMCkNCiAgcmVzcG9uc2UgPC0gdHJ5Q2F0Y2goDQogICAgUkN1cmw6OnBvc3RGb3JtKGF1dGhfdXJsLCBjbGllbnRfaWQgPSBhcHBfa2V5LCBjbGllbnRfc2VjcmV0ID0gYXBwX3NlY3JldCwgZ3JhbnRfdHlwZSA9ICdjbGllbnRfY3JlZGVudGlhbHMnLCAub3B0cyA9IG9wdFRpbWVvdXQpLA0KICAgIGVycm9yID0gZnVuY3Rpb24oZSkgeyByZXR1cm4oTkEpIH0pDQogIGlmIChpcy5uYShyZXNwb25zZSkpIHsNCiAgICByZXR1cm4oTkEpDQogIH0gZWxzZSB7DQogICAgaWYoanNvbmxpdGU6OnZhbGlkYXRlKHJlc3BvbnNlWzFdKSl7DQogICAgICByZXR1cm4ocmpzb246OmZyb21KU09OKHJlc3BvbnNlWzFdKSRhY2Nlc3NfdG9rZW4pDQogICAgfSBlbHNlIHsNCiAgICAgIHJldHVybihOQSkNCiAgICB9DQogIH0NCn0NCnNldHVwQXBwIDwtIGZ1bmN0aW9uKHBpYV91cmwsIGFwcF9rZXksIGFwcF9zZWNyZXQpIHsNCiAgYXBwX3Rva2VuIDwtIGdldFRva2VuKHBpYV91cmwsIGFwcF9rZXksIGFwcF9zZWNyZXQpDQogIGlmKGlzLm5hKGFwcF90b2tlbikpew0KICAgIHZlY3RvcigpDQogIH0gZWxzZSB7DQogICAgYygndXJsJyA9IHBpYV91cmwsICdhcHBfa2V5JyA9IGFwcF9rZXksICdhcHBfc2VjcmV0JyA9IGFwcF9zZWNyZXQsICd0b2tlbicgPSBhcHBfdG9rZW4pDQogIH0NCn0NCnIyZCA8LSBmdW5jdGlvbihyZXNwb25zZSl7DQogIGlmIChpcy5uYShyZXNwb25zZSkpIHsNCiAgICBkYXRhLmZyYW1lKCkNCiAgfSBlbHNlIHsNCiAgICBpZiAobmNoYXIocmVzcG9uc2UpID4gMCkgew0KICAgICAgcmV0VmFsIDwtIHJqc29uOjpmcm9tSlNPTihyZXNwb25zZSkNCiAgICAgIGlmKGxlbmd0aChyZXRWYWwpID09IDApIHsNCiAgICAgICAgZGF0YS5mcmFtZSgpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoJ2Vycm9yJyAlaW4lIG5hbWVzKHJldFZhbCkpIHsNCiAgICAgICAgICBkYXRhLmZyYW1lKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoIWlzLm51bGwocmV0VmFsJG1lc3NhZ2UpKSB7DQogICAgICAgICAgICBpZiAocmV0VmFsJG1lc3NhZ2UgPT0gDQogICAgICAgICAgICAgICAgJ2Vycm9yLmFjY2Vzc0RlbmllZCcpIHsNCiAgICAgICAgICAgICAgZGF0YS5mcmFtZSgpDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAjIGNvbnZlcnQgbGlzdCB0byBkYXRhLmZyYW1lDQogICAgICAgICAgICAgIGRvLmNhbGwoYmluZF9yb3dzLCBsYXBwbHkocmV0VmFsLCBmdW5jdGlvbih4KSBkYXRhLmZyYW1lKHQoc2FwcGx5KHgsYykpLCBzdHJpbmdzQXNGYWN0b3JzID0gRkFMU0UpKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZG8uY2FsbChiaW5kX3Jvd3MsIGxhcHBseShyZXRWYWwsIGZ1bmN0aW9uKHgpIGRhdGEuZnJhbWUodChzYXBwbHkoeCxjKSksIHN0cmluZ3NBc0ZhY3RvcnMgPSBGQUxTRSkpKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICBkYXRhLmZyYW1lKCkNCiAgICB9DQogIH0NCn0NCnJlYWRJdGVtcyA8LSBmdW5jdGlvbihhcHAsIHJlcG9fdXJsKSB7DQogIGlmIChsZW5ndGgoYXBwKSA9PSAwKSB7DQogICAgZGF0YS5mcmFtZSgpDQogICAgcmV0dXJuKCkNCiAgfQ0KICBoZWFkZXJzIDwtIGRlZmF1bHRIZWFkZXJzKGFwcFtbJ3Rva2VuJ11dKQ0KICB1cmxfZGF0YSA8LSBwYXN0ZTAocmVwb191cmwsICc/c2l6ZT0yMDAwJykNCiAgaGVhZGVyIDwtIFJDdXJsOjpiYXNpY0hlYWRlckdhdGhlcmVyKCkNCiAgZG9jIDwtIHRyeUNhdGNoKA0KICAgIFJDdXJsOjpnZXRVUkkodXJsX2RhdGEsIC5vcHRzPWxpc3QoaHR0cGhlYWRlciA9IGhlYWRlcnMpLCBoZWFkZXJmdW5jdGlvbiA9IGhlYWRlciR1cGRhdGUpLA0KICAgIGVycm9yID0gZnVuY3Rpb24oZSkgeyByZXR1cm4oTkEpIH0pDQogIHJlc3BvbnNlIDwtIE5BDQogIHJlc3BEYXRhIDwtIGRhdGEuZnJhbWUoKQ0KICBpZighaXMubmEoZG9jKSl7DQogICAgcmVjcyA8LSB0cnlDYXRjaCgNCiAgICAgIGFzLmludGVnZXIoaGVhZGVyJHZhbHVlKClbWydYLVRvdGFsLUNvdW50J11dKSwNCiAgICAgIGVycm9yID0gZnVuY3Rpb24oZSkgeyByZXR1cm4oMCl9KQ0KICAgIGlmKHJlY3MgPiAyMDAwKSB7DQogICAgICBmb3IocGFnZSBpbiAwOmZsb29yKHJlY3MvMjAwMCkpew0KICAgICAgICB1cmxfZGF0YSA8LSBwYXN0ZTAocmVwb191cmwsICc/cGFnZT0nLCBwYWdlLCAnJnNpemU9MjAwMCcpDQogICAgICAgIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgICAgICAgIFJDdXJsOjpnZXRVUkwodXJsX2RhdGEsIC5vcHRzPWxpc3QoaHR0cGhlYWRlcj1oZWFkZXJzKSksDQogICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbihlKSB7IHJldHVybihOQSkgfSkNCiAgICAgICAgc3ViRGF0YSA8LSByMmQocmVzcG9uc2UpDQogICAgICAgIGlmKG5yb3cocmVzcERhdGEpPjApew0KICAgICAgICAgIHJlc3BEYXRhIDwtIHJiaW5kKHJlc3BEYXRhLCBzdWJEYXRhKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3BEYXRhIDwtIHN1YkRhdGENCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICByZXNwb25zZSA8LSB0cnlDYXRjaCgNCiAgICAgICAgUkN1cmw6OmdldFVSTCh1cmxfZGF0YSwgLm9wdHM9bGlzdChodHRwaGVhZGVyID0gaGVhZGVycykpLA0KICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICAgICAgcmVzcERhdGEgPC0gcjJkKHJlc3BvbnNlKQ0KICAgIH0NCiAgfQ0KICByZXNwRGF0YQ0KfQ0Kd3JpdGVJdGVtIDwtIGZ1bmN0aW9uKGFwcCwgcmVwb191cmwsIGl0ZW0pIHsNCiAgaGVhZGVycyA8LSBkZWZhdWx0SGVhZGVycyhhcHBbWyd0b2tlbiddXSkNCiAgZGF0YSA8LSByanNvbjo6dG9KU09OKGl0ZW0pDQogIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgIFJDdXJsOjpwb3N0Rm9ybShyZXBvX3VybCwgLm9wdHM9bGlzdChodHRwaGVhZGVyID0gaGVhZGVycywgcG9zdGZpZWxkcyA9IGRhdGEpKSwNCiAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgDQogICAgICByZXR1cm4oTkEpIH0pDQogIHJlc3BvbnNlDQp9DQp1cGRhdGVJdGVtIDwtIGZ1bmN0aW9uKGFwcCwgcmVwb191cmwsIGl0ZW0sIGlkKSB7DQogIGhlYWRlcnMgPC0gZGVmYXVsdEhlYWRlcnMoYXBwW1sndG9rZW4nXV0pDQogIGl0ZW0gPC0gYyhpdGVtLCBjKGlkPWFzLm51bWVyaWMoaWQpKSkNCiAgZGF0YSA8LSByanNvbjo6dG9KU09OKGl0ZW0pDQogIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgIFJDdXJsOjpwb3N0Rm9ybShyZXBvX3VybCwgLm9wdHM9bGlzdChodHRwaGVhZGVyID0gaGVhZGVycywgcG9zdGZpZWxkcyA9IGRhdGEpKSwNCiAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICByZXNwb25zZQ0KfQ0KZGVsZXRlSXRlbSA8LSBmdW5jdGlvbihhcHAsIHJlcG9fdXJsLCBpZCl7DQogIGhlYWRlcnMgPC0gZGVmYXVsdEhlYWRlcnMoYXBwW1sndG9rZW4nXV0pDQogIGl0ZW1fdXJsIDwtIHBhc3RlMChyZXBvX3VybCwgJy8nLCBpZCkNCiAgcmVzcG9uc2UgPC0gdHJ5Q2F0Y2goDQogICAgaHR0cjo6REVMRVRFKGl0ZW1fdXJsLCBhZGRfaGVhZGVycyhoZWFkZXJzKSksDQogICAgZXJyb3IgPSBmdW5jdGlvbihlKSB7IHJldHVybihOQSkgfSkNCiAgcmVzcG9uc2UNCn0NCg0KcGlhX3VybCA8LSAnW3BpYV91cmxdJw0KYXBwX2tleSA8LSAnW2FwcF9rZXldJw0KYXBwX3NlY3JldCA8LSAnW2FwcF9zZWNyZXRdJw0KYXBwIDwtIHNldHVwQXBwKHBpYV91cmwsIGFwcF9rZXksIGFwcF9zZWNyZXQpDQpmYV91cmwgPC0gaXRlbXNVcmwocGlhX3VybCwgJ2V1Lm93bnlvdXJkYXRhLmZpdGJpdC50b2tlbicpDQpmYSA8LSByZWFkSXRlbXMoYXBwLCBmYV91cmwpDQppZihucm93KGZhKSA9PSAxKXsNCiAga2V5IDwtIGZhJGtleQ0KICBzZWNyZXQgPC0gZmEkc2VjcmV0DQogIGhlYWRlcnMgPC0gYygnQWNjZXB0Jz0nKi8qJywgJ0NvbnRlbnQtVHlwZSc9J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsICdBdXRob3JpemF0aW9uJz1wYXN0ZSgnQmFzaWMnLCBqc29ubGl0ZTo6YmFzZTY0X2VuYyhwYXN0ZTAoa2V5LCAnOicsIHNlY3JldCkpKSkNCiAgciA8LSBodHRyOjpQT1NUKCdodHRwczovL2FwaS5maXRiaXQuY29tL29hdXRoMi90b2tlbicsIGJvZHk9bGlzdChncmFudF90eXBlPSdyZWZyZXNoX3Rva2VuJywgcmVmcmVzaF90b2tlbj1mYSRyZWZyZXNoX3Rva2VuKSwgYWRkX2hlYWRlcnMoLmhlYWRlcnM9aGVhZGVycyksIGVuY29kZT0nZm9ybScpDQogIGRhdGEgPC0gbGlzdChrZXk9a2V5LCBzZWNyZXQ9c2VjcmV0LCBhY2Nlc3NfdG9rZW49Y29udGVudChyKSRhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW49Y29udGVudChyKSRyZWZyZXNoX3Rva2VuKQ0KICB1cGRhdGVJdGVtKGFwcCwgZmFfdXJsLCBkYXRhLCBmYSRpZCkNCiAgYWNjZXNzX3Rva2VuIDwtIGNvbnRlbnQocikkYWNjZXNzX3Rva2VuDQogIHVybCA8LSBpdGVtc1VybChwaWFfdXJsLCAnZXUub3dueW91cmRhdGEuZml0Yml0LnN0ZXBzJykNCiAgcGlhX2RhdGEgPC0gcmVhZEl0ZW1zKGFwcCwgdXJsKQ0KICBwaWFfZGF0YSA8LSBhcy5kYXRhLmZyYW1lKGxhcHBseShwaWFfZGF0YSwgdW5saXN0KSkNCiAgcmVzcCA8LSBHRVQoJ2h0dHBzOi8vYXBpLmZpdGJpdC5jb20vMS91c2VyLy0vYWN0aXZpdGllcy9zdGVwcy9kYXRlL3RvZGF5LzFtLmpzb24nLCBhZGRfaGVhZGVycyguaGVhZGVycyA9IGRlZmF1bHRIZWFkZXJzKGFjY2Vzc190b2tlbikpKQ0KICBmaXRfZGF0YSA8LSBqc29ubGl0ZTo6ZnJvbUpTT04oaHR0cjo6Y29udGVudChyZXNwLCBhcz0ndGV4dCcpKVtbMV1dDQogIGNvbG5hbWVzKGZpdF9kYXRhKSA8LSBjKCdkYXRlJywgJ3ZhbHVlJykNCiAgZGYgPC0gbWVyZ2UocGlhX2RhdGEsIGZpdF9kYXRhLCBieT0nZGF0ZScsIGFsbD1UUlVFKQ0KICBkZiA8LSBkZltkZiR2YWx1ZS55ID4gMCwgXQ0KICBhcHBseShkZiwgMSwgZnVuY3Rpb24oeCl7DQogICAgZGF0YSA8LSBsaXN0KGRhdGU9YXMuY2hhcmFjdGVyKHhbJ2RhdGUnXSksIHZhbHVlPWFzLmludGVnZXIoeFsndmFsdWUueSddKSwgJ19veWRSZXBvTmFtZSc9J1NjaHJpdHRlJykNCiAgICBpZihpcy5uYSh4WydpZCddKSl7DQogICAgICB3cml0ZUl0ZW0oYXBwLCB1cmwsIGRhdGEpDQogICAgfSBlbHNlIHsNCiAgICAgIHVwZGF0ZUl0ZW0oYXBwLCB1cmwsIGRhdGEsIHhbJ2lkJ10pDQogICAgfQ0KICB9KQ0KfQ=='
